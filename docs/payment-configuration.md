# 彩虹易支付配置说明

## 配置信息

- **接口地址**: `https://pay.myzfw.com/`
- **商户ID**: `16253`
- **签名方式**: MD5（V1接口）
- **商户MD5密钥**: `fbGfCkr541RBGEE5eyGC3CgglO3EFbb3`

## 环境变量配置

在 `.env.local` 文件中添加以下配置：

```bash
# 彩虹易支付配置
VITE_EPAY_API_URL=https://pay.myzfw.com/
VITE_EPAY_PID=16253
VITE_EPAY_MERCHANT_KEY=fbGfCkr541RBGEE5eyGC3CgglO3EFbb3
```

## 支付流程

1. **创建支付订单**
   - 用户选择商品和支付方式
   - 系统生成商户订单号
   - 调用支付接口创建订单

2. **签名生成**
   - 将请求参数按字母顺序排序
   - 拼接成 `key1=value1&key2=value2` 格式
   - 在末尾追加商户密钥
   - 对整个字符串进行MD5加密

3. **发起支付**
   - 用户跳转到支付页面
   - 完成支付操作

4. **回调处理**
   - 接收支付平台的异步通知
   - 验证签名确保数据安全性
   - 更新订单状态

## API 接口说明

### 发起支付接口

- **接口地址**: `https://pay.myzfw.com/api/pay/submit`
- **请求方式**: GET/POST
- **参数说明**:
  - `pid`: 商户ID
  - `type`: 支付方式（alipay/wxpay/qqpay/bank）
  - `out_trade_no`: 商户订单号
  - `name`: 商品名称
  - `money`: 支付金额
  - `notify_url`: 异步通知地址
  - `return_url`: 同步跳转地址
  - `sign`: MD5签名
  - `sign_type`: 签名类型（MD5）

### 查询订单接口

- **接口地址**: `https://pay.myzfw.com/api/pay/query`
- **请求方式**: POST
- **参数说明**:
  - `pid`: 商户ID
  - `trade_no`: 平台交易号
  - `sign`: MD5签名

## 安全注意事项

1. **密钥安全**
   - 商户密钥应妥善保管，不要泄露
   - 生产环境建议将密钥存储在后端
   - 定期更换密钥以提高安全性

2. **签名验证**
   - 所有回调数据必须验证签名
   - 防止数据被篡改
   - 防止重复提交

3. **订单验证**
   - 检查订单金额是否匹配
   - 验证订单状态
   - 记录支付日志

## 测试建议

1. 使用小额金额进行测试
2. 测试各种支付方式是否正常
3. 验证回调处理逻辑
4. 检查异常情况的处理

## 常见问题

1. **签名错误**
   - 检查参数排序是否正确
   - 确认密钥配置是否正确
   - 验证编码格式（建议使用UTF-8）

2. **支付失败**
   - 检查商户ID是否正确
   - 确认接口地址是否正确
   - 查看支付平台返回的错误信息

3. **回调未收到**
   - 检查通知地址是否可访问
   - 确认服务器防火墙设置
   - 查看支付平台日志

## 后端集成建议

为了提高安全性，建议将以下功能移至后端实现：

1. 密钥存储和管理
2. 签名生成和验证
3. 订单状态更新
4. 支付回调处理

前端只负责：
1. 展示支付界面
2. 调用后端API创建订单
3. 跳转到支付页面
4. 展示支付结果